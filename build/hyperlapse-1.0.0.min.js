/*!
 * Hyperlapse.js v1.0.0
 * (c) TeehanLax - juampi92 - https://juampi92.github.io/Hyperlapse.js
 * License: MIT (http://www.opensource.org/licenses/mit-license.php)
*/
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(c){Number.prototype.toRad=function(){return this*Math.PI/180},Number.prototype.toDeg=function(){return 180*this/Math.PI},Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);return this.length=0>a?this.length+a:a,this.push.apply(this,c)};var d=function(a,b,c){var d=b.lat().toRad(),e=b.lng().toRad(),f=c.lat().toRad(),g=c.lng().toRad();return x=d+a*(f-d),y=e+a*(g-e),new google.maps.LatLng(x.toDeg(),y.toDeg())},e=a("./HyperlapsePoint"),f=function(a,b){"use strict";var c,f,g,h,i,j,k,l=this,m=a,n=b||{},o=n.width||800,p=n.height||400,q=20,r=n.use_elevation||!1,s=n.distance_between_points||5,t=n.max_points||100,u=n.fov||70,v=n.zoom||1,w=0,x=0,y=0,z=0,A=!1,B=!1,C=0,D=0,E=0,F=!0,G=0,H=0,I=!1,J=Date.now(),K=0,L=null,M=[],N=[],O=function(a){l.onError&&l.onError(a)},P=function(a){l.onFrame&&l.onFrame(a)},Q=function(a){l.onPlay&&l.onPlay(a)},R=function(a){l.onPause&&l.onPause(a)},S=new google.maps.ElevationService;new google.maps.StreetViewService;c=document.createElement("canvas"),f=c.getContext("2d"),g=new THREE.PerspectiveCamera(u,o/p,1,1100),g.target=new THREE.Vector3(0,0,0),h=new THREE.Scene,h.add(g);var T=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(a){return console.log("WebGL not available starting with CanvasRenderer"),!1}};i=T()?new THREE.WebGLRenderer:new THREE.CanvasRenderer,i.autoClearColor=!1,i.setSize(o,p),j=new THREE.Mesh(new THREE.SphereGeometry(500,60,40),new THREE.MeshBasicMaterial({map:new THREE.Texture,side:THREE.DoubleSide,overdraw:!0})),h.add(j),m.appendChild(i.domElement),k=new GSVPANO.PanoLoader({zoom:v}),k.onError=function(a){O({message:a})},k.onPanoramaLoad=function(){var a=document.createElement("canvas"),b=a.getContext("2d");a.setAttribute("width",this.canvas.width),a.setAttribute("height",this.canvas.height),b.drawImage(this.canvas,0,0),N[C].image=a,++C!=N.length?(V({position:C}),I?U({}):k.composePanorama(N[C].pano_id)):W({})};var U=function(a){I=!1,B=!1,l.onLoadCanceled&&l.onLoadCanceled(a)},V=function(a){l.onLoadProgress&&l.onLoadProgress(a)},W=function(a){B=!1,C=0,ca(),l.onLoadComplete&&l.onLoadComplete(a)},X=function(a){l.onRouteProgress&&l.onRouteProgress(a)},Y=function(a){for(var b=[],c=0;c<N.length;c++)b[c]=N[c].location;if(r)$(b,function(b){if(b)for(c=0;c<N.length;c++)N[c].elevation=b[c].elevation;else for(c=0;c<N.length;c++)N[c].elevation=-1;l.setLookat(l.lookat,!0,function(){l.onRouteComplete&&l.onRouteComplete(a)})});else{for(c=0;c<N.length;c++)N[c].elevation=-1;l.setLookat(l.lookat,!1,function(){l.onRouteComplete&&l.onRouteComplete(a)})}},Z=function(a){k.load(M[C],function(){if(k.id!=L){L=k.id;var b=new e(k.location,k.id,{heading:k.rotation,pitch:k.pitch,elevation:k.elevation,copyright:k.copyright,image_date:k.image_date});N.push(b),X({point:b}),C==M.length-1?Y({response:a,points:N}):(C++,I?U({}):Z(a))}else M.splice(C,1),C==M.length?Y({response:a,points:N}):I?U({}):Z(a)})},$=function(a,b){var c={locations:a};S.getElevationForLocations(c,function(a,c){c==google.maps.ElevationStatus.OK?b(a):(c==google.maps.ElevationStatus.OVER_QUERY_LIMIT&&console.log("Over elevation query limit."),r=!1,b(null))})},_=function(a){if(A)l.pause(),_(a);else{for(var b=a.routes[0],c=b.overview_path,e=b.legs,f=0,g=0;g<e.length;++g)f+=e[g].distance.value;var h=f/t;q=q=s>h?s:h;var i,j,k=0,m=0;for(g=0;g<c.length;g++)if(g+1<c.length){if(i=c[g],j=c[g+1],k=google.maps.geometry.spherical.computeDistanceBetween(i,j),m>0&&k>m?(i=d(m/k,i,j),k=google.maps.geometry.spherical.computeDistanceBetween(i,j),M.push(i),m=0):m>0&&m>k&&(m-=k),0===m){var n=Math.floor(k/q);if(n>0){for(var o=0;n>o;o++){var p=o/n;if(p>0||p+g===0){var r=d(p,i,j);M.push(r)}}m=k-q*n}else m=q*(1-k/q)}}else M.push(c[g]);Z(a)}},aa=function(){if(j.material.map.image=N[C].image,j.material.map.needsUpdate=!0,D=N[C].heading,E=N[C].pitch,l.use_lookat&&(G=google.maps.geometry.spherical.computeHeading(N[C].location,l.lookat)),-1!=N[C].elevation){var a=N[C].elevation-l.elevation_offset,b=google.maps.geometry.spherical.computeDistanceBetween(N[C].location,l.lookat),c=H-a,d=Math.atan(Math.abs(c)/b).toDeg();z=0>c?-d:d}P({position:C,point:N[C]})},ba=function(){if(!B&&l.length()>0){var a=C/l.length(),b=l.position.x+l.offset.x*a,c=l.position.y+l.offset.y*a,d=l.tilt+l.offset.z.toRad()*a,e=l.use_lookat?G-D.toDeg()+b:b,f=z+c,k=x,m=w;x+=e-k,w+=f-m,w=Math.max(-85,Math.min(85,w));var n=(90-w).toRad(),o=x.toRad();g.target.x=500*Math.sin(n)*Math.cos(o),g.target.y=500*Math.cos(n),g.target.z=500*Math.sin(n)*Math.sin(o),g.lookAt(g.target),g.rotation.z-=d,l.use_rotation_comp&&(g.rotation.z-=l.rotation_comp.toRad()),j.rotation.z=E.toRad(),i.render(h,g)}},ca=function(){var a=J;J=Date.now(),K+=J-a,K>=l.millis&&(A&&da(),K=0),requestAnimationFrame(ca),ba()},da=function(){aa(),F?++C==N.length&&(C=N.length-1,F=!F):-1==--C&&(C=0,F=!F)};this.lookat=n.lookat||null,this.millis=n.millis||50,this.elevation_offset=n.elevation||0,this.tilt=n.tilt||0,this.position={x:0,y:0},this.offset={x:0,y:0,z:0},this.use_lookat=n.use_lookat||!1,this.use_rotation_comp=!1,this.rotation_comp=0,this.isPlaying=function(){return A},this.isLoading=function(){return B},this.length=function(){return N.length},this.setPitch=function(a){z=a},this.setDistanceBetweenPoint=function(a){s=a},this.setMaxPoints=function(a){t=a},this.fov=function(){return u},this.webgl=function(){return i},this.getCurrentImage=function(){return N[C].image},this.getCurrentPoint=function(){return N[C]},this.setLookat=function(a,b,c){if(l.lookat=a,r&&b){$([l.lookat],function(a){a&&(H=a[0].elevation),c&&c.apply&&c()})}else c&&c.apply&&c()},this.setFOV=function(a){u=Math.floor(a),g.projectionMatrix.makePerspective(u,o/p,1,1100)},this.setSize=function(a,b){o=a,p=b,i.setSize(o,p),g.projectionMatrix.makePerspective(u,o/p,1,1100)},this.reset=function(){M.remove(0,-1),N.remove(0,-1),l.tilt=0,w=0,x=0,l.position.x=0,l.offset.x=0,l.offset.y=0,l.offset.z=0,y=0,z=0,C=0,D=0,E=0,F=!0},this.generate=function(a){if(!B){B=!0,l.reset();var b=a||{};s=b.distance_between_points||s,t=b.max_points||t,b.route?_(b.route):console.log("No route provided.")}},this.load=function(){C=0,k.composePanorama(N[C].pano_id)},this.cancel=function(){B&&(I=!0)},this.getCameraPosition=function(){return new google.maps.LatLng(w,x)},this.play=function(){B||(A=!0,Q({}))},this.pause=function(){A=!1,R({})},this.next=function(){l.pause(),C+1!=N.length&&(C++,aa())},this.prev=function(){l.pause(),C-1!==0&&(C--,aa())}};c.Hyperlapse=b.exports=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./HyperlapsePoint":2}],2:[function(a,b,c){var d=function(a,b,c){var d=c||{};this.location=a,this.pano_id=b,this.heading=d.heading||0,this.pitch=d.pitch||0,this.elevation=d.elevation||0,this.image=d.image||null,this.copyright=d.copyright||"Â© 2013 Google",this.image_date=d.image_date||""};b.exports=d},{}]},{},[1]);